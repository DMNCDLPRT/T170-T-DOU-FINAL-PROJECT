<main class="body-container">
    <div class="home container">
        <h3 class="text-center my-2">Edit Your Comment</h3>
        <div class="validate error text-danger text-center mb-2"></div>
        <hr>
        <div class="forms w-75 m-auto">
            <form action="/products/<%=id%>/reviews/<%=rev_id%>?_method=PATCH" class="rating-system" method="POST" novalidate>
                <div class="rating-num mb-2">
                  <label class="form-label" for="customRange2">Give Your Rating</label>
                  <div class="range">
                    <input type="range" name="prodRating"class="form-range" min="0" max="5" id="customRange2" value="<%=data.rating%>"required/>
                  </div>
                </div>
                <div class="review-item form-outline mb-3">
                  <textarea class="form-control" id="textAreaExample" name="prodComment" rows="4" required><%=data.comment%></textarea>
                  <label class="form-label" for="textAreaExample">Write a Product Review</label>
                </div>
                <div class="submit-button"><button type="submit" class="btn btn-primary mb-4">Save</button></div>
              </form>
             
        </div>
    </div>
  
</main>
<script>
    /* const alertAlert = document.getElementsByClassName('.alert.alert-danger'); */
    const form = document.querySelector('form');
    const validate = document.querySelector('.validate.error');
    form.addEventListener('submit', async (e) => {
        e.preventDefault();
        // reset errors
        
        validate.textContent = '';
        /* alertAlert.textContent = ''; */
        // get values
        const rating = form.prodRating.value;
        const comment = form.prodComment.value;

        try {
            const res = await fetch('/products/<%=id%>/reviews/<%=rev_id%>?_method=PATCH', { 
                method: 'POST',
                enctype: 'multipart/form-data',
                body: JSON.stringify({ rating, comment }),
                headers: {'Content-Type': 'application/json'}
            });

            const data = await res.json();
            console.log(data);

            if (data.error) { validate.textContent = data.error; }
            if (data.message) { validate.textContent = data.message; }
            if (data.rating) {
                form.classList.add('was-validated');
                location.assign('/view/products/<%=user.id%>');
            }
        } catch (err) {
            console.log(err);
        }
    });
</script>